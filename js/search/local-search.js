window.addEventListener("load",()=>{let t=!1,n=[];const a=document.getElementById("search-mask"),e=()=>{var e=document.body.style;e.width="100%",e.overflow="hidden",btf.animateIn(a,"to_show 0.5s"),btf.animateIn(document.querySelector("#local-search .search-dialog"),"titleScale 0.5s"),setTimeout(()=>{document.querySelector("#local-search-input input").focus()},100),t||(c(),t=!0),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(l(),document.removeEventListener("keydown",e))})},l=()=>{var e=document.body.style;e.width="",e.overflow="",btf.animateOut(document.querySelector("#local-search .search-dialog"),"search_close .5s"),btf.animateOut(a,"to_hide 0.5s")},s=()=>{document.querySelector("#search-button > .search").addEventListener("click",e)};const r=e=>{return/\.json$/.test(e)},o=async e=>{let t=[];var a=await fetch(e);return t=r(e)?await a.json():(e=await a.text(),[...(await await(new window.DOMParser).parseFromString(e,"text/xml")).querySelectorAll("entry")].map(e=>({title:e.querySelector("title").textContent,content:e.querySelector("content")&&e.querySelector("content").textContent,url:e.querySelector("url").textContent,tags:e.querySelector("tags")&&e.querySelector("tags").textContent}))),a.ok&&((e=document.getElementById("loading-database")).nextElementSibling.style.display="block",e.remove()),t},c=()=>{GLOBAL_CONFIG.localSearch.preload||(n=o(GLOBAL_CONFIG.localSearch.path));var e=document.querySelector("#local-search-input input");const t=document.getElementById("local-search-results"),a=document.getElementById("loading-status");e.addEventListener("input",function(){const f=this.value.trim().toLowerCase().split(/[\s]+/);if(""===f[0])t.innerHTML="";else{a.innerHTML='<i class="fas fa-spinner fa-pulse"></i>';let p='<div class="search-result-list">';if(!(f.length<=0)){let m=0;n.then(e=>{e.forEach(e=>{let a=!0,n=e.title?e.title.trim().toLowerCase():"";const o=e.content?e.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"";var c=e.url.startsWith("/")?e.url:GLOBAL_CONFIG.root+e.url;const i=e.tags||"";let l,s=-1,d=-1,r,u=f[0].toString().split("").length;if(""!==n||""!==o?f.forEach((e,t)=>{if("#"===f[0][0]&&1<u&&"#"!==f[0][1]){e=e.substring(1);let t="";for(let e=0;e<i.length;e++)t=t.concat(i[e].replace(/<[^>]+>/g,""));t=t.trim().toLowerCase(),(r=t.indexOf(e))<0?a=!1:d=0}else l=n.indexOf(e),s=o.indexOf(e),l<0&&s<0?a=!1:(s<0&&(s=0),0===t&&(d=s))}):a=!1,a){if(0<=d){let e=d-30,t=d+100,l="",s="",r=(0===(e=e<0?0:e)?t=100:l="...",t>o.length?t=o.length:s="...",o.substring(e,t));if(f.forEach(e=>{"#"===e[0]&&1<e.length&&(e=e.substring(1)),r=r.replaceAll(e,'<span class="search-keyword">'+e+"</span>"),n=n.replaceAll(e,'<span class="search-keyword">'+e+"</span>")}),p+='<div class="local-search__hit-item"><a href="'+c+'" class="search-result-title" target="_blank">'+n+"</a>",m+=1,""!==o){let t="",a=1;for(let e=0;e<i.length;e++)/\S/.test(i[e])?(a=0,t=t.concat(i[e])):0===a&&(t+="；；",a=1);for(let e=0;e<t.length;e++){var h=t.length;t=(t="；"==t[h-1]&&1<h?t.substring(0,h-2):t).trim().toLowerCase()}f.forEach(e=>{"#"===e[0]&1<e.length&&(e=e.substring(1)),t=t.replaceAll(e,'<span class="search-keyword">'+e+"</span>")});let n='<br/><i class="fas fa-tag"><span style="font-family:times">';a=1;for(let e=0;e<t.length;e++)"；"!==t[e]?(a=0,n=n.concat(t[e])):0===a&&(n+='</span></i>&nbsp &nbsp<i class="fas fa-tag"><span style="font-family:times">',a=1);n+="</span></i>",s=""!==t?s+n:s,p+='<p class="search-result">'+l+r+s+"</p>"}}p+="</a></div>"}}),0===m&&(p+='<div id="local-search__hits-empty">'+GLOBAL_CONFIG.localSearch.languages.hits_empty.replace(/\$\{query}/,this.value.trim())+"</div>"),p+="</div>",t.innerHTML=p,""!==f[0]&&(a.innerHTML=""),window.pjax&&window.pjax.refresh(t)})}}})};s(),document.querySelector("#local-search .search-close-button").addEventListener("click",l),a.addEventListener("click",l),GLOBAL_CONFIG.localSearch.preload&&(n=o(GLOBAL_CONFIG.localSearch.path)),window.addEventListener("pjax:complete",()=>{btf.isHidden(a)||l(),s()})});